
<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/meta',{ time:time}) %>
  <title><%= title %></title>

  <!-- Font Awesome -->
  <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"> -->
  <link rel="stylesheet" href="/cdn/fontawesome/css/all.min.css">
  <!-- SweetAlert2 -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> -->
  <script src="/cdn/sweetalert2.all.min.js"></script>
  <!-- Flatpkr -->
  <link rel="stylesheet" href="/cdn/flatpickr.min.css">
  <script src="/cdn/flatpickr.js"></script>

  <% if(!IS_PRODUCTION) { %>
  <link rel="stylesheet" href="/css/utils.css?v=<%= time %>">
  <link rel="stylesheet" href="/css/fontsAnuphan.css?v=<%= time %>">
  <link rel="stylesheet" href="/css/toast.css?v=<%= time %>">
  <link rel="stylesheet" href="/css/flex.css?v=<%= time %>">
  <link rel="stylesheet" href="/css/alink.css?v=<%= time %>">
  <!-- <link rel="stylesheet" href="/css/input.css?v=<%= time %>"> - แยก input ไปต่าหาก -->
  <link rel="stylesheet" href="/css/nav.css?v=<%= time %>">
  <link rel="stylesheet" href="/css/modal.css?v=<%= time %>">
  <link rel="stylesheet" href="/css/same.css?v=<%= time %>">
  <link rel="stylesheet" href="/css/inputQuotation.css?v=<%= time %>"> 
  <link rel="stylesheet" href="/css/quotation.css?v=<%= time %>"> 
  <style>
    /* input.flatpickr-input{
      background-color: white!important;
      color: blue!important;
    } */
  </style>
  <% } else { %>
  <link rel="stylesheet" href="/css-min/quotation.min.css?v=<%= time %>">
  <% }  %>
</head>
<body>

  <%- include('partials/nav.ejs') %>
  <%- include('partials/notify.ejs', {msg:msg}) %> 
  <!-- Top Toolbar -->
  <header class="header-ctn">
    <section class="header-toolbar">

      <!-- 1 -->
      <form class="header-toolbar-1" action="<%= PATH_MAIN %>" method="get">
        <!-- <div class="d-flex align-items-center"> -->
          <input class="al-c bdr3 no-x" type="search" autocomplete="off"                  
                 title="เลขที่/ปี-เดือน-วัน/ลูกค้า"
                 placeholder="เลขที่/ปี-เดือน-วัน/ลูกค้า" id="sip" name="sip">
          <button class="btn-xlh btn-sm bg-search" id="btnSearchDocs" title="ค้นหาเอกสาร">
            <i class="fa fa-search"></i>
          </button>

          <button class="btn-xlh btn-sm bg-clear mg-l-m" 
                  title="ล้างผลการค้นหา" 
                  id="btnClearSearch" >
            <i class="fa fa-broom"></i>
          </button>
          <select class="al-l w-100 h-100 bdr3 fs-m" 
                  style="min-width:350px;"
                  id="selectDocToLoad" name="selectDocToLoad"></select>

          <input class="al-c bdr3 h-100" type="text"
                  style="width:60px;"
                  id="searchResNum" readonly>
          <button class="btn-xlh btn-sm bg-load" type="submit" id="btnLoadDoc" title="โหลดเอกสาร">
            <i class="fa fa-download"></i>
          </button>        
        <!-- </div> -->
      </form>

      <!-- 2 -->
      <div class="header-toolbar-2">
        <button class="btn-xlh btn-sm bg-cancel" 
                id="btnCancelDoc"  title="ยกเลิกเอกสาร (ไม่สามารถแก้ไขได้) เสนอลูกค้าแล้ว แต่ลูกค้าไม่ตอบสนอง">
          <i class="fa fa-ban mg-r-s"></i>ยกเลิก
        </button>

        <button class="btn-xlh btn-sm bg-finish mg-l-l" 
                id="btnFinishDoc"  title="จบเอกสาร (ไม่สามารถแก้ไขได้) เสนอลูกค้าแล้ว ลูกค้าซื้อหรือว่าจ้างตามเอกสารนี้">
          <i class="fa fa-flag-checkered mg-r-s"></i>จบ
        </button>
      </div>

      <!-- 3 -->
      <div class="header-toolbar-3" >
        <!-- <div class="d-flex align-items-center"> -->
          <button class="btn-xlh bg-change pd-l-l pd-r-l" id="btnPrintChanges" title="พิมพ์ข้อมูลการเปลี่ยนแปลง">
            <i class="fa-solid fa-print mg-r-s"></i>Changes
          </button>
  
          <button class="btn-xlh btn-sm bg-download mg-l-l" id="btnDownloadImage" title="ดาวน์โหลดภาพ">
            <i class="fa fa fa-download mg-r-s"></i>ภาพ
          </button>
  
          <button class="btn-xlh btn-sm bg-download mg-l-l" id="btnDownloadPDF" title="ดาวน์โหลด PDF">
            <i class="fa fa fa-download mg-r-s"></i>PDF
          </button>
  
          <button class="btn-xlh bg-print pd-l-l pd-r-l mg-l-l" id="btnPrint" title="พิมพ์">
            <i class="fa-solid fa-print mg-r-s"></i>HTML
          </button>
        <!-- </div> -->
      </div>

      <!-- 4 -->
      <div class="header-toolbar-4">
        <!-- <div class="d-flex align-items-center"> -->
          <button class="btn-xlh btn-sm bg-save" id="btnSave" title="บันทึก">
            <i class="fa fa fa-save mg-r-s"></i>บันทึก
          </button>
        <!-- </div> -->
      </div>

      <!-- 5 -->
      <div class="header-toolbar-5">
        <!-- <div class="d-flex align-items-center"> -->

          <button class="btn-xlh btn-sm bg-new" 
                  id="btnClone" title="ทำสำเนา">
            <i class="fa fa-file-circle-plus mg-r-s"></i>ทำสำเนา
          </button>

          <button class="btn-xlh btn-sm bg-clear mg-l-xl"
                  id="btnReload" title="โหลดใหม่">
            <i class="fa fa-rotate-right mg-r-m"></i>โหลดใหม่
          </button>
        <!-- </div> -->
      </div>

    </section>
  </header>

  <!-- MAIN CONTAINER -->
  <main class="watermark">

    <!-- PAPER FORM -->
    <form id="paperForm" class="mg-b-xxl" action="<%= PATH_MAIN %>" method="post" autocomplete="off">

      <section class="paper-ctn" id="paperCtn">

        <!-- #1 : Header  -->
        <div class="d-flex justify-content-between pd-t-m pd-b-m bb-thick">

          <!-- Logo -->
          <img src="<%= logoSrc_base64 %>" style="width:auto;height:50px;">

          <!-- ที่อยู่ -->
          <div class="al-r d-flex align-items-center">
            <div class="lh-3xs">
              <p class="fs-sm fw-b"><%= HEADER_COMPANY_NAME %></p>
              <p><span class="fs-s fi"><%= HEADER_LINE_2 %></span></p>
              <p><span class="fs-s fi"><%= HEADER_LINE_3 %></span></p>
            </div>
          </div>

        </div>

        <!-- #2 : Title ใบเสนอราคา  -->
        <div class="pd-t-xl pd-b-s" style="position: relative;">
          <!-- เพิ่มไอเท็ม -->
          <button class="ba-d bdr3 btn-sm bg-white mg-t-xl" title="ล้างข้อมูลลูกค้า และพิมพ์รายละเอียดลูกค้าเอง"
                  style="position:absolute;top:0;left:0px;color:orange!important;padding-bottom:4px!important;"
                  id="btnClearCustomer" >
            <i class="fa fa-broom"></i>
          </button>
          <div class="modalCtn ba-d bdr3 mg-t-xl" 
               style="position: absolute;top:0;left: 30px;">
            <input class="al-c pd-l-m w-100" type="text" autocomplete="off"
                   id="searchCustomers" tabindex="-1"
                   style="min-width: 200px;"
                   placeholder="เลือกลูกค้า" 
                   onfocus="popModalCustomers(event)" 
                   oninput="popModalCustomers(event)" >
            <div class="modal">
              <div class="modal-list"></div>
            </div>
          </div>

          <!-- Title -->
          <p class="al-c fw-b fs-xxl"><span>ใบเสนอราคา</span></p> 

          <input class="ba-d al-c mg-t-xl no-arrow" type="number" 
                 readonly
                 name="docStatusNumber" id="docStatusNumber" 
                 style="position:absolute;top:0;right:0px;max-width:100px;border-radius:3px!important; "
                 title="<%= global.DOC_STATUS_TITLE %>"
                 placeholder="สถานะเอกสาร">
        </div> 
          
        <!-- #3 : ข้อมูลลูกค้า -->
        <div class="rowg pd-t-m pd-b-l">

          <!--  -->
          <input type="hidden" id="customerId" name="customerId">

          <!-- #3.1 : ข้อมูลลูกค้า - ซ้าย -->
          <div class="colg-1">     

            <!-- ชื่อลูกค้า -->
            <div class="row">
              <p class="col-10 al-l pd-l-s "><span class="fs-n">ลูกค้า :</span></p>
              <input class="col-90 pd-l-s fw-b bb-k-d" type="text" 
                     required
                     id="customerName" name="customerName">
            </div>

            <!-- ที่อยู่1 -->
            <div class="row">
              <p class="col-08 al-l pd-l-s"><span class="fs-n">ที่อยู่ :</span></p>
              <input class="col-92 al-l pd-l-s fw-b  bb-k-d" type="text" 
                     id="customerAddress1" name="customerAddress1">
            </div>

            <!-- ที่อยู่2 -->
            <div class="row">
              <p class="col-08"></p>
              <input class="col-92 al-l fw-b bb-k-d" type="text" 
                     id="customerAddress2" name="customerAddress2">
            </div>
            
            <!-- ติดต่อ -->
            <div class="row">
              <p class="col-08"></p>
              <input class="col-92 al-l fw-b bb-k-d" type="text" 
                     id="customerContactChannel" name="customerContactChannel">
            </div>

            <!-- เลขประจำตัวผู้เสียภาษีอากร -->
            <div class="row">
              <p class="col-08"></p>
              <div class="col-92 bb-k-d">
                <span class="al-l fs-sn">เลขประจำตัวผู้เสียภาษีอากร :</span>
                <input class="fw-b " type="text" id="customerTaxId" name="customerTaxId">
              </div>
            </div>

            <!-- ผู้ติดต่อ -->
            <div class="row">
              <p class="col-08"></p>
              <div class="col-92 bb-k-d">
                 <span class="al-l fs-sn">ผู้ติดต่อ :</span>
                <input class="fw-b " type="text" 
                      id="customerContactPerson" name="customerContactPerson">
              </div>
            </div>
            
          </div>

          <!-- #3.2 : ข้อมูลลูกค้า - ขวา -->
          <div class="colg-2">

            <!-- วันที่ -->
            <div class="row">
              <p class="col-20 lh-4xs pd-t-l">
                <span class="fs-n">วันที่ : </span>                  
              </p>
              <input class="col-80 al-c fw-b  bb-k-d bg-white clickable" type="date" 
                     required tabindex="-1"
                     id="docDateTh" name="docDateTh">
            </div>

            <!-- เลขที่ -->
            <div class="row">
              <p class="col-20 lh-4xs pd-t-l">
                <span class="fs-n">เลขที่ : </span>
              </p>
              <input class="col-80 al-c fw-b  bb-k-d pd-l-s" type="text"
                     placeholder="เลขที่เอกสาร" tabindex="-1"
                     readonly
                     id="docId" name="docId" >
            </div>

            <!-- อ้างอิง -->
            <div class="row">
              <p class="col-20 lh-4xs pd-t-l">
                <span class="fs-n">อ้างอิง : </span>
              </p>
              <input class="col-80 al-c fw-b bb-k-d pd-l-s" type="text" 
                     id="docRefNo" name="docRefNo">
            </div>

            <!-- เพิ่มไอเท็ม -->
            <div class="modalCtn ba-d bdr3 pd-l-s mg-t-xl">
              <input class="al-c pd-l-m w-100" type="text" 
                     id="searchItems" tabindex="-1"
                     placeholder="เพิ่มรายการจากข้อมูลไอเท็ม"
                     onfocus="popModalItems(event)" 
                     oninput="popModalItems(event)" >
              <div class="modal">
                <div class="modal-list"></div>
              </div>
            </div>

          </div>

        </div>

        <!-- #4 --><!-- รายการ - Container -->
        <div id="tableListCtn">

          <!-- 1 - หัวตาราง -->
          <div class="row" id="tableHeaderCtn" style="position: relative;">
            <button class="undo-delete-row-btn" id="btnUndoDeleteRow" title="ยกเลิกลบแถว" tabindex="-1">
              <i class="fa fa-undo"></i>
            </button>

            <label class="col-05 lh-xs al-c bt-k bb-k bl-k pd-t-s pd-b-s">
              <!-- <span class="fc-liblue clickable" onclick="sortItemsTableJs(1,'asc')">▲</span> -->
              <span class="fs-m">ลำดับ</span> 
              <!-- <span class="fc-liblue clickable" onclick="sortItemsTableJs(1,'dsc')">▼</span> -->
            </label>
            <label class="col-54 lh-xs al-c bt-k bb-k bl-k pd-t-s pd-b-s">
              <span class="fc-liblue clickable" onclick="sortItemsTableJs(2,'asc')">▲</span>
              <span class="fs-m">รายการ</span>
              <span class="fc-liblue clickable" onclick="sortItemsTableJs(2,'dsc')">▼</span>
            </label>
            <label class="col-07 lh-xs al-c bt-k bb-k bl-k pd-t-s pd-b-s">
              <span class="fs-m">จำนวน</span>
            </label>
            <label class="col-08 lh-xs al-c bt-k bb-k bl-k pd-t-s pd-b-s">
              <span class="fs-m">หน่วย</span>
            </label>
            <label class="col-12 lh-xs al-c bt-k bb-k bl-k pd-t-s pd-b-s">
              <span class="fs-m">ราคา</span>
            </label>
            <label class="col-14 lh-xs al-c bt-k bb-k bl-k br-k pd-t-s pd-b-s">
              <span class="fs-m">รวม</span>
            </label>

            <!-- ปุ่ม + ลอยออกนอกตาราง -->
            <button class="add-row-btn" id="btnAddRow" title="เพิ่มแถว" tabindex="-1">
              <i class="fa fa-plus"></i>
            </button>
          </div>

          <!-- 2 - สำหรับสร้างรายการ -->
          <div id="listCtn"></div>

          <!-- 3 - โซนผลรวม -->
          <div class="row" id="mainTotalCtn">

            <!-- total co#l1 -->
            <div class="col-70" id="paymentMethodCtn">
              <textarea name="docRemark" id="docRemark" 
                        class="w-100 h-100 al-l bd-n pd-m lh-3xs" 
                        placeholder="หมายเหตุ/เงื่อนไขการชำระเงิน"
                        style="resize:none;overflow: hidden;"
                        rows="9"><%= DOC_REMARK %></textarea>   
            </div>

            <!-- total co#l2 -->
            <div class="col-30" id="columnTotalCtn">

              <!-- แถวรวม : Total Amount -->
              <div class="row bb-k" id="totalCtn">
                <p class="col-53 lh-4xs al-r pd-t-s pd-b-s">
                  <span class="fs-m fw-b">รวม</span>
                </p>
                <input class="col-47 al-r pd-r-s fw-b " type="text"  tabindex="-1"
                       id="totalAmount" name="totalAmount" readonly>
              </div>

              <!-- แถว VAT -->
              <div class="row bb-k" id="totalVatCtn">
                <p class="col-53 lh-4xs al-r pd-t-s pd-b-s">
                  <span class="fs-m fw-b ">ภาษีมูลค่าเพิ่ม 7%</span>
                </p>
                <input class="col-47 al-r pd-r-s fw-b" type="text"  tabindex="-1"
                       id="vatAmount" name="vatAmount" readonly>

                <!-- ปุ่ม + ลอยออกนอกตาราง -->
                <select class="select-vat-calculating" tabindex="-1"
                        id="selectVatCalculating" name="selectVatCalculating"
                        title="เลือกวิธีคำนวณ Vat">
                  <option value="noVat" selected>ไม่มี Vat</option>
                  <option value="vatIn">คำนวณ Vat ใน</option>
                  <option value="vatOut">คำนวณ Vat นอก</option>
                </select> 
               
              </div>

              <!-- แถว Net Amount -->
              <div class="row bb-k-db" id="netCtn">
                <p class="col-53 al-r lh-4xs pd-t-s pd-b-s">
                  <span class="fs-m fw-b ">รวมทั้งสิ้น</span>
                </p>
                <input class="col-47 al-r pd-r-s fw-b" tabindex="-1"
                      type="text" id="netAmount" name="netAmount" min="0" readonly>
              </div>

            </div> <!-- total co#l2 -->


          </div>

        </div>


        <!-- สำหรับลูกค้า -->
        <div class="row" id="bottomZoneCtn">
          <!--  -->
          <div class="col-40 ba-k pd-l fs-sm">
            <p class="underline">สำหรับลูกค้า :</p>
            <p>ยืนยันการว่างจ้างตามเงื่อนไขและราคาข้างต้น</p>
            <div style="min-height: 100px;"></div>
            <p class="al-c">ลายเซ็นผู้มีอำนาจ (ลงชื่อและประทับตรา)</p>
          </div>

          <!--  -->
          <div class="col-30"></div>

          <!--  -->
          <div class="col-30 pd-m">

            <!--  -->
            <select class="select-signature" tabindex="-1"
                    id="selectProposerSignature" name="selectProposerSignature"
                    title="เลือกแสดงลายเซ็นหรือไม่">
              <option value="1" selected>แสดง</option>
              <option value="0">ซ่อน</option>
            </select> 

            <!--  -->
            <p class="fs-m lh-m al-c">ผู้เสนอราคา</p>
            
            <!-- ภาพลายเซ็น --><!-- onerror="this.style.display='none';" -->
            <div class="al-c" style="min-height: 65px;">
              <% if(userImageSignature_Src) { %>
              <img id="proposerImageSignature"
                   src="<%- userImageSignature_Src ? userImageSignature_Src : '' %>" 
                   style="width:auto;height:60px;" 
                   alt="ลายเซ็นผู้เสนอราคา">
              <% } %>
            </div>

            <!-- ผู้เสนอราคา -->
            <div class="al-c">

              <!-- มาจาก Session : ดึง userId มาเลย  -->
              <input type="hidden" id="proposerId" name="proposerId" tabindex="-1"
                     value="<%= userId ? userId : '' %>">

              <!--  -->
              <div class="col-100 d-flex justify-content-between bt-k-d">
                <span class="mg-t-m">(</span>
                <span class="w-100 mg-t-m">
                  <input class="al-c fw-b" type="text" 
                         id="proposerFullname" name="proposerFullname" tabindex="-1"
                         readonly
                         value="<%= userFullname ? userFullname : '' %>">
                </span>
                <span class="mg-t-m">)</span>
              </div>

            </div>

            <!-- วันที่เสนอราคา -->
            <!-- 
            <div class="d-flex justify-content-between pd-t-s al-c lh-m">
              <span class="fs-s mg-r-s">วันที่</span>
              (<input class="col-100 al-c fw-b  bg-white clickable" type="date" 
                      required tabindex="-1"
                      id="proposerDateTh" name="proposerDateTh">)
            </div> 
            -->
          </div>
          
        </div>   <!-- 5 -->  
        
        
      </section><!-- paper ctn -->
    </form>

  </main>

  <!--  -->
  <%- include('partials/footer') %>

  <!--  -->
  <script>
    const PATH_MAIN = `<%= PATH_MAIN %>`
    const PATH_FETCH = `<%= PATH_FETCH %>`
    const PATH_SEARCH = `<%= PATH_SEARCH %>`
    const PATH_SAVE = `<%= PATH_SAVE %>`
    const PATH_LOAD = `<%= PATH_LOAD %>`
    const PATH_PRINT = `<%= PATH_PRINT %>`
    const PATH_CHANGES = `<%= PATH_CHANGES %>`
    const PATH_STATUS = `<%= PATH_STATUS %>`
    const DOC_ID = `<%= DOC_ID %>`
    const SIP = `<%= SIP %>`
  </script>
  <% if(!IS_PRODUCTION) { %>
  <script type="text/javascript" src="/js/script_all.js?v=<%= time %>"></script>
  <script type="text/javascript" src="/js/nav.js?v=<%= time %>"></script>
  <script type="text/javascript" src="/js/notify.js?v=<%= time %>"></script>
  <script type="text/javascript" src="/js/doc_table.js?v=<%= time %>"></script>
  <script type="text/javascript" src="/js/doc_modal.js?v=<%= time %>"></script>
  <script type="text/javascript" src="/js/quotation_formAction.js?v=<%= time %>"></script>
  <script type="text/javascript" src="/js/quotation_crud.js?v=<%= time %>"></script>
  <% } else { %>
  <script src="/js-min/quotation.obf.js"></script>
  <% }  %>

</body>
</html>

